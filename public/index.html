<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Captain Talon â€” Eagle Chat</title>

<style>
body {
  margin: 0;
  font-family: system-ui, Arial;
  background: #0b1220;
  color: #eaf2ff;
}
.wrap {
  max-width: 1000px;
  margin: auto;
  padding: 18px;
  display: grid;
  gap: 16px;
}
.card {
  background: #121c33;
  border: 1px solid #243155;
  border-radius: 16px;
  padding: 14px;
}
.row {
  display: grid;
  grid-template-columns: 420px 1fr;
  gap: 16px;
}
@media (max-width: 900px) {
  .row { grid-template-columns: 1fr; }
}
#log {
  height: 420px;
  overflow-y: auto;
  padding: 10px;
  background: #0f1730;
  border-radius: 12px;
  border: 1px solid #243155;
}
.msg { margin: 10px 0; }
.me { color: #b8d7ff; }
.bot { color: #ffe7a6; }
.label { font-weight: 700; margin-right: 6px; }

.controls {
  display: grid;
  grid-template-columns: 1fr auto auto;
  gap: 10px;
  margin-top: 10px;
}
input {
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #243155;
  background: #0f1730;
  color: #eaf2ff;
}
button {
  padding: 12px 14px;
  border-radius: 12px;
  border: 1px solid #243155;
  background: #1b2a52;
  color: #eaf2ff;
  cursor: pointer;
}

.status {
  text-align: center;
  font-size: 14px;
  opacity: .9;
}

/* Talking animation helpers */
#lowerBeak {
  transform-origin: 210px 165px;
  transition: transform 90ms ease-out;
}
#mouthGap {
  opacity: 0;
  transition: opacity 90ms ease-out;
}

/* Overlay */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.75);
  display: grid;
  place-items: center;
  z-index: 50;
}
.overlay button {
  font-size: 20px;
}
</style>
</head>

<body>

<div class="overlay" id="overlay">
  <div class="card">
    <h2>ðŸ¦… Start Captain Talon</h2>
    <p>Click Start so the eagle can talk.</p>
    <button onclick="startCaptain()">Start</button>
  </div>
</div>

<div class="wrap">
<h1>ðŸ¦… Captain Talon â€” Eagle Chat</h1>

<div class="row">
<div class="card">

<!-- REALISTIC SIDE-PROFILE EAGLE -->
<svg id="eagle" width="420" height="320" viewBox="0 0 420 320">

  <!-- Head -->
  <ellipse cx="180" cy="170" rx="120" ry="100" fill="#f2f2f2"/>

  <!-- Eye -->
  <circle cx="170" cy="145" r="8" fill="#111"/>
  <circle cx="173" cy="142" r="3" fill="#fff"/>

  <!-- Upper beak -->
  <path
    d="M190 160
       C260 150 320 165 360 185
       C300 190 245 188 190 178 Z"
    fill="#f0b429"/>

  <!-- Mouth gap (dark interior) -->
  <path
    id="mouthGap"
    d="M190 178
       C250 185 290 195 320 210
       C260 215 230 210 190 200 Z"
    fill="#2b1b16"/>

  <!-- Lower beak (HINGED) -->
  <g id="lowerBeak">
    <path
      d="M190 178
         C255 190 305 210 335 235
         C260 235 230 225 190 215 Z"
      fill="#d9941e"/>
  </g>

</svg>

<div class="status" id="status">Click Start to begin, Little Wing.</div>
</div>

<div class="card">
  <div id="log"></div>
  <div class="controls">
    <input id="text" placeholder="Ask Captain Talonâ€¦" />
    <button id="send">Send</button>
    <button id="mute">ðŸ”Š On</button>
  </div>
</div>
</div>
</div>

<script>
const overlay = document.getElementById("overlay");
const log = document.getElementById("log");
const text = document.getElementById("text");
const sendBtn = document.getElementById("send");
const muteBtn = document.getElementById("mute");
const lowerBeak = document.getElementById("lowerBeak");
const mouthGap = document.getElementById("mouthGap");
const statusEl = document.getElementById("status");

let muted = false;
let audioReady = false;
let history = [];

function addMsg(role, content) {
  const div = document.createElement("div");
  div.className = `msg ${role === "user" ? "me" : "bot"}`;
  div.innerHTML = `<span class="label">${role === "user" ? "You:" : "Captain Talon:"}</span>${content}`;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}

function speak(text) {
  if (!audioReady || muted) return;
  const u = new SpeechSynthesisUtterance(text);
  u.rate = 1.0;
  u.pitch = 0.9;

  u.onstart = () => {
    lowerBeak.style.transform = "rotate(12deg)";
    mouthGap.style.opacity = "1";
  };
  u.onend = () => {
    lowerBeak.style.transform = "rotate(0deg)";
    mouthGap.style.opacity = "0";
  };

  speechSynthesis.speak(u);
}

async function ask() {
  const q = text.value.trim();
  if (!q) return;

  addMsg("user", q);
  history.push({ role: "user", content: q });
  text.value = "";

  const r = await fetch("/api/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ userText: q, history })
  });

  const data = await r.json();
  const reply = data.reply || "Screee!";
  addMsg("assistant", reply);
  history.push({ role: "assistant", content: reply });
  speak(reply);
}

sendBtn.onclick = ask;
text.onkeydown = e => e.key === "Enter" && ask();

muteBtn.onclick = () => {
  muted = !muted;
  muteBtn.textContent = muted ? "ðŸ”‡ Off" : "ðŸ”Š On";
};

window.startCaptain = function() {
  overlay.style.display = "none";
  audioReady = true;
  const intro = "Screee! This is an awesome presentation, Austin! Iâ€™m Captain Talon.";
  addMsg("assistant", intro);
  speak(intro);
};
</script>

</body>
</html>
